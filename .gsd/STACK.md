# Technology Stack

> Auto-generated by /map on 2026-01-19

## Runtime

| Technology | Version | Purpose |
|------------|---------|---------|
| Browser (ES6+) | Modern browsers | JavaScript runtime |
| Tone.js | 14.8.49 | Audio synthesis, scheduling, and effects engine |
| HTML5 | - | Drag & Drop API, Audio Context |
| CSS3 | - | Animations, filters, variables |

## Production Dependencies

Loaded via CDN (no package.json present):

| Package | Version | Purpose | Load Method |
|---------|---------|---------|-------------|
| Tone.js | 14.8.49 | Audio synthesis, Transport scheduling, effects (BitCrusher, PitchShift, Distortion, etc.) | `<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js">` |

**Note:** Project has NO package.json - all dependencies loaded via CDN. This creates:
- ✅ Zero build step, simple deployment
- ❌ No version locking, CDN dependency risk
- ❌ No dependency tree management

## Development Dependencies

**None** - project uses no build tools, bundlers, or dev dependencies.

## Source Files Inventory

### Core Audio (src/core/)
| File | Lines | Purpose |
|------|-------|---------|
| AudioEngine.js | 386 | Tone.js wrapper, manages sample/synth sources |
| Sequencer.js | 286 | Pattern-based timing via Tone.Transport |
| SampleManager.js | ~150 | Audio file loading and preloading |
| BonusManager.js | ~200 | Combo detection system |
| CorruptionManager.js | ~250 | Horror mode cellular automata |
| HorrorEffects.js | ~300 | Audio/visual transformation effects |

### UI Components (src/ui/)
| File | Lines | Purpose |
|------|-------|---------|
| DragDrop.js | 172 | HTML5 Drag & Drop handler |
| BonusOverlay.js | ~150 | Bonus animation overlay |

### Data Configuration (src/data/)
| File | Lines | Purpose |
|------|-------|---------|
| ThemeLoader.js | ~200 | JSON config loading and CSS injection |
| samples.js | ~100 | Hardcoded sample config (fallback) |
| bonuses.js | ~80 | Hardcoded bonus config (fallback) |

### Application Entry
| File | Lines | Purpose |
|------|-------|---------|
| main.js | 708 | Application coordinator, state management |
| index.html | 61 | Entry point, script loading order |
| style.css | ~600 | All styles (no preprocessor) |

**Total Source:** ~3,000 lines of JavaScript + CSS

## Infrastructure

| Service | Provider | Purpose |
|---------|----------|---------|
| GitHub Pages | GitHub | Static hosting (planned deployment) |
| Local Server | Python/Node.js | Development server (required for audio files) |
| Browser Audio Context | Browser | Audio playback (requires user gesture to unlock) |

## Configuration

### Environment Variables
**None** - project has no environment-specific config.

### Configuration Files

| File | Purpose | Format |
|------|---------|--------|
| `themes/{id}/theme.json` | Theme configuration (sounds, colors, bonuses, corruption) | JSON |
| `.gitignore` | Version control exclusions | Text |

### Theme JSON Schema
```json
{
  "meta": { "id", "name", "bpm", "key", "loopBars" },
  "colors": { "primary", "accent", "beats", "effects", ... },
  "background": { "type", "colors", "image" },
  "sounds": {
    "{soundName}": {
      "name", "type", "icon", "iconEmoji",
      "sound", "soundB",
      "pattern", "subdivision",
      "cursed", "synth": { "type", "options" }
    }
  },
  "bonuses": [
    { "id", "title", "requiredSounds", "animation", "duration", "repeatable" }
  ],
  "corruption": {
    "enabled", "triggerSound", "spreadRate", "spreadAmount",
    "tickInterval", "tiers", "cureCombo"
  },
  "ui": { "slotCount", "slotSize", "iconSize", "showBpmDisplay" }
}
```

## Audio Specifications

### Sample Format (Theme Assets)
```
Format:         OGG Vorbis (primary), MP3 (fallback)
Sample Rate:    44.1kHz
Bit Depth:      16-bit
Channels:       Stereo for music, mono for SFX
Target Size:    50-100KB per loop
Loop Length:    4 bars @ 120 BPM = 8 seconds
```

### Synth Fallback (Tone.js)
| Sound | Tone.js Synth | Configuration |
|-------|---------------|---------------|
| kick | MembraneSynth | `pitchDecay: 0.05, octaves: 6` |
| snare | NoiseSynth | `noise: { type: 'white' }` |
| hihat | MetalSynth | `frequency: 300, harmonicity: 5.1` |
| bass | MonoSynth | `oscillator: { type: 'triangle' }` |
| lead | MonoSynth | `oscillator: { type: 'square' }` |
| cursed | MonoSynth | `oscillator: { type: 'sawtooth' }` |

## Browser Compatibility

| Feature | Requirement | Fallback |
|---------|-------------|----------|
| ES6 JavaScript | Modern browsers (2018+) | None - required |
| Web Audio API | Chrome 35+, Firefox 25+, Safari 9+ | None - required |
| Drag & Drop API | All modern browsers | None - required |
| CSS Grid | Chrome 57+, Firefox 52+, Safari 10.1+ | Flexbox fallback in some areas |
| CSS Variables | Chrome 49+, Firefox 31+, Safari 9.1+ | None - required for theming |

**Mobile Support:** Phase 7 (planned) - currently desktop-focused

## Asset Structure

```
themes/
└── default/
    ├── theme.json          # Configuration
    ├── sounds/             # Audio loops (.ogg, .mp3)
    │   ├── kick.ogg
    │   ├── kick_b.ogg     # A/B variation
    │   └── ...
    ├── icons/              # Sound icons (.png, .svg)
    │   └── kick.png
    ├── backgrounds/        # Stage backgrounds
    ├── animations/         # Bonus animations
    └── effects/            # Visual effects
```

## Development Tools

### Required
- **Local HTTP Server** (Python `http.server`, Node.js `serve`, or VS Code Live Server)
  - Reason: CORS restrictions on `file://` protocol prevent audio loading

### Recommended (from TOOLS.md)
- **Audacity** - Audio editing for sample loops
- **LMMS/Ableton Live Lite** - Music production
- **VSCode** - Code editor
- **Chrome DevTools** - Debugging, performance profiling

### Version Control
- **Git** - Repository initialized, commit history preserved
- **GitHub** - Planned hosting via GitHub Pages

## Dependencies Analysis

### Current Dependency: Tone.js 14.8.49

**Pros:**
- Solves clock drift in Web Audio API
- Built-in Transport scheduler (25ms interval, 100ms lookahead)
- Rich effects library (BitCrusher, PitchShift, Distortion, FrequencyShifter, Tremolo)
- Abstracts browser quirks (Safari, mobile)
- ~10-30KB gzipped

**Cons:**
- CDN dependency (no offline mode)
- No version locking (breaking changes possible)
- Single point of failure (CDN downtime)

**Update Status:**
- Version 14.8.49 released: ~2021
- Latest Tone.js: v15+ (breaking changes in API)
- **Risk:** Current version outdated, but project stable

**Recommendation:** Migrate to npm + bundler (Vite/Rollup) for production

### Potential Future Dependencies

From research documents and PLAN.md:

| Library | Purpose | Phase |
|---------|---------|-------|
| Tone.Recorder | Session recording to WAV/MP3 | Phase 7 |
| Lamejs | Client-side MP3 encoding | Phase 7 |
| Pizzicato.js | Alternative audio effects | Research only |
| WebAudioFont | MIDI-style synths | Research only |

## Technical Debt Summary

### High Priority
- [ ] **No package.json** - Migrate to npm for dependency management
- [ ] **CDN versioning** - Lock Tone.js version, consider local copy

### Medium Priority
- [ ] **No build process** - Add bundler (Vite recommended for simplicity)
- [ ] **No module system** - Scripts loaded in order, brittle
- [ ] **Global singletons** - Refactor to dependency injection

### Low Priority
- [ ] **No TypeScript** - Add type safety
- [ ] **No linter** - Add ESLint for code quality
- [ ] **No automated tests** - Add Jest or Vitest

## Performance Metrics

From development testing (DEVLOG.md):

| Metric | Value | Notes |
|--------|-------|-------|
| Bundle Size | ~0 KB | No bundling - scripts loaded individually |
| Tone.js Size | ~30 KB gzipped | CDN-loaded |
| Total Assets | ~500 KB - 1 MB | Depends on theme (sounds, icons) |
| RAM Usage | ~300-400 MB | Typical for 7 active slots |
| Audio Latency | <10ms desktop | Masked by bar quantization |
| | ~100ms mobile | Android constraint |

## Outdated Packages

| Package | Current | Latest | Risk | Action |
|---------|---------|--------|------|--------|
| Tone.js | 14.8.49 | 15.1+ | High | Major version upgrade required, breaking API changes |

**Note:** Since dependencies loaded via CDN, no automated update mechanism exists. Manual update would require:
1. Test compatibility with Tone.js v15 API changes
2. Update CDN URL in index.html
3. Regression test all audio features
